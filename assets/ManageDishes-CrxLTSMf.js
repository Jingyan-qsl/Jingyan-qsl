import{k as U,l as m,n as A,a as i,m as O,o as V,c as $,w as j,y as J,e as n,d as t,F as M,s as v,f as h,b as k,E as s,t as q}from"./index-DW0o-UDa.js";const G=k("input",{type:"file",id:"pic",name:"pic",accept:"image/png,image/gif,image/jpeg"},null,-1),P={class:"dialog-footer"},L={__name:"ManageDishes",setup(H){let c=U();const w=m(0),y=m([{id:"",name:"",img:"",price:"",text:"",createtime:"",updatetime:"",created:""}]),d=m({id:"",name:"",img:"",price:"",text:""}),r=m(!1),b=m(!0);A(()=>{g()});const C=o=>{d.value=JSON.parse(JSON.stringify(o)),r.value=!0,console.log(o)},T=()=>{let o=document.getElementById("pic");o.value=""},x=()=>{v({url:"remenu",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:c.token},data:d.value}).then(o=>{o.data.status==200?(r.value=!1,s({message:"修改成功",type:"success"}),g()):o.data.status==401?(s({message:"身份认证过期,请重新登录",type:"danger"}),q.push("/login"),localStorage.clear()):s({message:o.data.msg,type:"danger"})}).catch(o=>{s({message:"请求失败",type:"danger"})})},B=()=>{let e=document.getElementById("pic").files[0],a=new FormData;a.append("file",e),console.log(a.get("file")),a.get("file")!=null&&a.get("file")!=null&&a.get("file")!=""&&a.get("file")!="undefined"?v({url:"upload",method:"post",headers:{"content-type":"multipart/form-data",Authorization:c.token},data:a}).then(u=>{u.data.status==200?(console.log("图片上传成功:",u),d.value.img=u.data.url,x()):u.data.status==401?alert("身份认证过期,请重新登录"):alert("图片上传失败")}).catch(u=>{alert("图片上传请求失败")}):x()},g=o=>{b.value=!0,v({url:"getmenu",method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:c.token},params:{size:10,page:o}}).then(e=>{e.data.status==200?(y.value=e.data.data,b.value=!1,w.value=e.data.max_pages*10):e.data.status==401&&alert("身份认证过期,请重新登录")}).catch(e=>{alert("请求失败")})},D=o=>{v({url:"delmenu",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:c.token},data:{id:o}}).then(e=>{e.data.status==200?(s({message:"删除成功",type:"success"}),g()):e.data.status==401?s({message:"身份认证过期,请重新登录",type:"danger"}):s({message:e.data.msg,type:"danger"})}).catch(e=>{s({message:"请求失败",type:"danger"})})};return(o,e)=>{const a=i("el-table-column"),u=i("el-image"),f=i("el-button"),E=i("el-table"),I=i("el-pagination"),_=i("el-input"),p=i("el-form-item"),S=i("el-form"),z=i("el-dialog"),F=O("loading");return V(),$(M,null,[j((V(),J(E,{data:y.value,border:"",style:{width:"100%"},"element-loading-text":"加载中...","header-cell-style":{"text-align":"center"}},{default:n(()=>[t(a,{prop:"id",label:"序号",width:"60"}),t(a,{prop:"name",label:"菜名",width:"100"}),t(a,{label:"菜品图片",width:"85"},{default:n(l=>[t(u,{style:{width:"50px",height:"50px"},src:l.row.img},null,8,["src"])]),_:1}),t(a,{prop:"price",label:"价格",width:"60"}),t(a,{prop:"text",label:"介绍",width:"150"}),t(a,{prop:"createtime",label:"创建时间",width:"150"}),t(a,{prop:"updatetime",label:"更新时间",width:"150"}),t(a,{prop:"created",label:"创建者",width:"150"}),t(a,{label:"操作",width:"180"},{default:n(l=>[t(f,{type:"primary",onClick:N=>C(l.row)},{default:n(()=>[h("修改")]),_:2},1032,["onClick"]),t(f,{type:"danger",onClick:N=>D(l.row.id)},{default:n(()=>[h("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[F,b.value]]),t(I,{background:"",layout:"prev, pager, next",total:w.value,onCurrentChange:g,style:{"margin-top":"20px"}},null,8,["total"]),t(z,{modelValue:r.value,"onUpdate:modelValue":e[6]||(e[6]=l=>r.value=l),title:"修改菜品",width:"500",onClose:T},{footer:n(()=>[k("div",P,[t(f,{onClick:e[4]||(e[4]=l=>r.value=!1)},{default:n(()=>[h("取消")]),_:1}),t(f,{type:"primary",onClick:e[5]||(e[5]=l=>B())},{default:n(()=>[h(" 修改 ")]),_:1})])]),default:n(()=>[t(S,{model:d.value},{default:n(()=>[t(p,{label:"菜品ID"},{default:n(()=>[t(_,{modelValue:d.value.id,"onUpdate:modelValue":e[0]||(e[0]=l=>d.value.id=l),disabled:""},null,8,["modelValue"])]),_:1}),t(p,{label:"菜品名称"},{default:n(()=>[t(_,{modelValue:d.value.name,"onUpdate:modelValue":e[1]||(e[1]=l=>d.value.name=l)},null,8,["modelValue"])]),_:1}),t(p,{label:"上传图片"},{default:n(()=>[G]),_:1}),t(p,{label:"菜品价格"},{default:n(()=>[t(_,{modelValue:d.value.price,"onUpdate:modelValue":e[2]||(e[2]=l=>d.value.price=l)},null,8,["modelValue"])]),_:1}),t(p,{label:"菜品介绍"},{default:n(()=>[t(_,{modelValue:d.value.text,"onUpdate:modelValue":e[3]||(e[3]=l=>d.value.text=l),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}};export{L as default};
