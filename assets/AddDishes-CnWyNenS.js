import{z as f,n as _,r as g,a as i,o as x,y as h,e as n,d as a,f as V,b,s,t as y}from"./index-DW0o-UDa.js";const w=b("input",{type:"file",id:"pic",name:"pic",accept:"image/png,image/gif,image/jpeg"},null,-1),C=f({__name:"AddDishes",setup(k){const m=JSON.parse(localStorage.getItem("user")).token;_(()=>{console.log(m)});const e=g({name:"",img:"",price:"",text:""}),u=()=>{let l=document.getElementById("pic").files[0],o=new FormData;o.append("file",l),console.log(o.get("file")),s({url:"upload",method:"post",headers:{"content-type":"multipart/form-data",Authorization:m},data:o}).then(t=>{t.data.status==200?(console.log("图片上传成功:",t),e.img=t.data.url,s({url:"addmenu",method:"POST",headers:{"content-type":"application/x-www-form-urlencoded",Authorization:m},data:e}).then(d=>{d.data.status==200?(alert("新增成功"),e.img="",e.img="",e.price="",e.text=""):alert("新增失败")}).catch(d=>{alert("请求失败")})):t.data.status==401?(alert("身份认证过期,请重新登录"),y.push("/login"),localStorage.clear()):alert("图片上传失败")}).catch(t=>{alert("图片上传请求失败")})};return(p,l)=>{const o=i("el-input"),t=i("el-form-item"),d=i("el-button"),c=i("el-form");return x(),h(c,{model:e,"label-width":"auto",style:{"max-width":"300px"}},{default:n(()=>[a(t,{label:"菜品名称"},{default:n(()=>[a(o,{modelValue:e.name,"onUpdate:modelValue":l[0]||(l[0]=r=>e.name=r)},null,8,["modelValue"])]),_:1}),a(t,{label:"上传图片"},{default:n(()=>[w]),_:1}),a(t,{label:"菜品价格"},{default:n(()=>[a(o,{modelValue:e.price,"onUpdate:modelValue":l[1]||(l[1]=r=>e.price=r)},null,8,["modelValue"])]),_:1}),a(t,{label:"菜品介绍"},{default:n(()=>[a(o,{modelValue:e.text,"onUpdate:modelValue":l[2]||(l[2]=r=>e.text=r),type:"textarea"},null,8,["modelValue"])]),_:1}),a(t,null,{default:n(()=>[a(d,{type:"primary",onClick:u},{default:n(()=>[V("立即添加")]),_:1})]),_:1})]),_:1},8,["model"])}}});export{C as default};
